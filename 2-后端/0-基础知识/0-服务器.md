

## 线上部署需要注意

![线上问题](https://aeiblog-1301396258.cos.ap-chengdu.myqcloud.com/img/线上问题.png)

## apt

apt show <软件包名>

查看是否有该软件包

apt update：

只检查，不更新（已安装的软件包是否有可用的更新，给出汇总报告） ，获取最新的软件包库。

apt  <软件包名> install  

安装软件

`sudo apt-get -y install` (-y：yes，在命令行交互提示中，直接输入 yes；)

## Screen

未安装则输入如下命令安装 `sudo apt install screen`
查看 screen 列表 `screen -ls`
创建窗口 `screen -S name`
退出当前窗口 `ctrl +a d`
关闭窗口( 退出后删除该窗口 ) `ctrl+d`
进入名为name的窗口 `screen -r name`
远程连接进入screen窗口后突然掉线，重连遇到进不去窗口时可以通过以下命令踢掉上一个进入窗口的进程，然后进入窗口 `screen -D -r name`

## nginx （web端服务器）

#### 准备

1. 安装`apt install nginx -y`

2. 打开80端口` firewall-cmd --permanent --add-port=80/tcp `（同时打开阿里云的安全组80端口）

3. 重启防火墙：` firewall-cmd --reload `

4. 配置文件 `vim /etc/nginx/nginx.conf` (一般配置文件在这里)

5. 尝试直接实用域名或者ip地址打开网页

   [nginx安装路径，查找配置文件以及如何配置_铁柱的博客-CSDN博客_nginxconf文件在哪里](https://blog.csdn.net/LJFPHP/article/details/78474152) 

6. 配置https网站 

    [SSL 证书 Nginx 服务器 SSL 证书安装部署 - 证书安装 - 文档中心 - 腾讯云 (tencent.com)](https://cloud.tencent.com/document/product/400/35244) 

7. 配置Nginx反向代理 转到 下面的 Nginx配置

8. 可以使用 `nginx -t 查看nginx状态`

#### Nginx配置

VsCode下载一个`remote-SHH`用来远程的配置Nginx配置

使用`remote-SHH`连接到`/ect/nginx/`里

进入`sites-enabled`中，添加一个配置文件进行配置（这个文件表示所有已经启动的文件）。可以使用 [NGINXConfig | DigitalOcean](https://www.digitalocean.com/community/tools/nginx?global.app.lang=zhCN) 来配置

使用`service nginx reload`命令行重启nginx

## pm2

安装：`npm install -g pm2`

Midway使用pm2的教程:

 [使用 pm2 · 语雀 (yuque.com)](https://www.yuque.com/midwayjs/midway_v2/pm2) 

```bash
NODE_ENV=production pm2 start ./bootstrap.js --name midway_app -i 4

#生产模式下使用npm start所在的js文件，启用4个
```

## ps   查看进程

`ps-ef | grep nginx`：查看 nginx进程的文件位置

